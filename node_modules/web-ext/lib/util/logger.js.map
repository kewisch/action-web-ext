{"version":3,"file":"logger.js","names":["fileURLToPath","pino","levels","logLevels","ConsoleStream","verbose","isCapturing","capturedMessages","constructor","format","name","msg","level","prefix","labels","makeVerbose","write","jsonString","localProcess","process","packet","JSON","parse","thisLevel","values","trace","info","push","stderr","stdout","startCapturing","stopCapturing","flushCapturedLogs","consoleStream","createLogger","moduleURL","createPinoLog","replace"],"sources":["../../src/util/logger.js"],"sourcesContent":["import { fileURLToPath } from 'url';\n\nimport pino, { levels as logLevels } from 'pino';\n\nexport class ConsoleStream {\n  verbose;\n  isCapturing;\n  capturedMessages;\n\n  constructor({ verbose = false } = {}) {\n    this.verbose = verbose;\n    this.isCapturing = false;\n    this.capturedMessages = [];\n  }\n\n  format({ name, msg, level }) {\n    const prefix = this.verbose ? `[${name}][${logLevels.labels[level]}] ` : '';\n    return `${prefix}${msg}\\n`;\n  }\n\n  makeVerbose() {\n    this.verbose = true;\n  }\n\n  write(jsonString, { localProcess = process } = {}) {\n    const packet = JSON.parse(jsonString);\n    const thisLevel = this.verbose\n      ? logLevels.values.trace\n      : logLevels.values.info;\n    if (packet.level >= thisLevel) {\n      const msg = this.format(packet);\n      if (this.isCapturing) {\n        this.capturedMessages.push(msg);\n      } else if (packet.level > logLevels.values.info) {\n        localProcess.stderr.write(msg);\n      } else {\n        localProcess.stdout.write(msg);\n      }\n    }\n  }\n\n  startCapturing() {\n    this.isCapturing = true;\n  }\n\n  stopCapturing() {\n    this.isCapturing = false;\n    this.capturedMessages = [];\n  }\n\n  flushCapturedLogs({ localProcess = process } = {}) {\n    for (const msg of this.capturedMessages) {\n      localProcess.stdout.write(msg);\n    }\n    this.capturedMessages = [];\n  }\n}\n\nexport const consoleStream = new ConsoleStream();\n\n// createLogger types and implementation.\n\nexport function createLogger(moduleURL, { createPinoLog = pino } = {}) {\n  return createPinoLog(\n    {\n      // Strip the leading src/ from file names (which is in all file names) to\n      // make the name less redundant.\n      name: moduleURL\n        ? fileURLToPath(moduleURL).replace(/^src\\//, '')\n        : 'unknown-module',\n      // Capture all log levels and let the stream filter them.\n      level: logLevels.values.trace,\n    },\n    consoleStream,\n  );\n}\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,KAAK;AAEnC,OAAOC,IAAI,IAAIC,MAAM,IAAIC,SAAS,QAAQ,MAAM;AAEhD,OAAO,MAAMC,aAAa,CAAC;EACzBC,OAAO;EACPC,WAAW;EACXC,gBAAgB;EAEhBC,WAAWA,CAAC;IAAEH,OAAO,GAAG;EAAM,CAAC,GAAG,CAAC,CAAC,EAAE;IACpC,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,gBAAgB,GAAG,EAAE;EAC5B;EAEAE,MAAMA,CAAC;IAAEC,IAAI;IAAEC,GAAG;IAAEC;EAAM,CAAC,EAAE;IAC3B,MAAMC,MAAM,GAAG,IAAI,CAACR,OAAO,GAAG,IAAIK,IAAI,KAAKP,SAAS,CAACW,MAAM,CAACF,KAAK,CAAC,IAAI,GAAG,EAAE;IAC3E,OAAO,GAAGC,MAAM,GAAGF,GAAG,IAAI;EAC5B;EAEAI,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACV,OAAO,GAAG,IAAI;EACrB;EAEAW,KAAKA,CAACC,UAAU,EAAE;IAAEC,YAAY,GAAGC;EAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;IACjD,MAAMC,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACL,UAAU,CAAC;IACrC,MAAMM,SAAS,GAAG,IAAI,CAAClB,OAAO,GAC1BF,SAAS,CAACqB,MAAM,CAACC,KAAK,GACtBtB,SAAS,CAACqB,MAAM,CAACE,IAAI;IACzB,IAAIN,MAAM,CAACR,KAAK,IAAIW,SAAS,EAAE;MAC7B,MAAMZ,GAAG,GAAG,IAAI,CAACF,MAAM,CAACW,MAAM,CAAC;MAC/B,IAAI,IAAI,CAACd,WAAW,EAAE;QACpB,IAAI,CAACC,gBAAgB,CAACoB,IAAI,CAAChB,GAAG,CAAC;MACjC,CAAC,MAAM,IAAIS,MAAM,CAACR,KAAK,GAAGT,SAAS,CAACqB,MAAM,CAACE,IAAI,EAAE;QAC/CR,YAAY,CAACU,MAAM,CAACZ,KAAK,CAACL,GAAG,CAAC;MAChC,CAAC,MAAM;QACLO,YAAY,CAACW,MAAM,CAACb,KAAK,CAACL,GAAG,CAAC;MAChC;IACF;EACF;EAEAmB,cAAcA,CAAA,EAAG;IACf,IAAI,CAACxB,WAAW,GAAG,IAAI;EACzB;EAEAyB,aAAaA,CAAA,EAAG;IACd,IAAI,CAACzB,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,gBAAgB,GAAG,EAAE;EAC5B;EAEAyB,iBAAiBA,CAAC;IAAEd,YAAY,GAAGC;EAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;IACjD,KAAK,MAAMR,GAAG,IAAI,IAAI,CAACJ,gBAAgB,EAAE;MACvCW,YAAY,CAACW,MAAM,CAACb,KAAK,CAACL,GAAG,CAAC;IAChC;IACA,IAAI,CAACJ,gBAAgB,GAAG,EAAE;EAC5B;AACF;AAEA,OAAO,MAAM0B,aAAa,GAAG,IAAI7B,aAAa,CAAC,CAAC;;AAEhD;;AAEA,OAAO,SAAS8B,YAAYA,CAACC,SAAS,EAAE;EAAEC,aAAa,GAAGnC;AAAK,CAAC,GAAG,CAAC,CAAC,EAAE;EACrE,OAAOmC,aAAa,CAClB;IACE;IACA;IACA1B,IAAI,EAAEyB,SAAS,GACXnC,aAAa,CAACmC,SAAS,CAAC,CAACE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,GAC9C,gBAAgB;IACpB;IACAzB,KAAK,EAAET,SAAS,CAACqB,MAAM,CAACC;EAC1B,CAAC,EACDQ,aACF,CAAC;AACH","ignoreList":[]}