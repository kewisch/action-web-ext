{"version":3,"file":"logger.js","names":["fileURLToPath","bunyan","nameFromLevel","createLogger","defaultLogCreator","ConsoleStream","verbose","isCapturing","capturedMessages","constructor","format","name","msg","level","prefix","makeVerbose","write","packet","localProcess","process","thisLevel","TRACE","INFO","push","stderr","stdout","startCapturing","stopCapturing","flushCapturedLogs","consoleStream","moduleURL","createBunyanLog","replace","streams","type","stream"],"sources":["../../src/util/logger.js"],"sourcesContent":["import { fileURLToPath } from 'url';\n\nimport bunyan, {\n  nameFromLevel,\n  createLogger as defaultLogCreator,\n} from 'bunyan';\n\nexport class ConsoleStream {\n  verbose;\n  isCapturing;\n  capturedMessages;\n\n  constructor({ verbose = false } = {}) {\n    this.verbose = verbose;\n    this.isCapturing = false;\n    this.capturedMessages = [];\n  }\n\n  format({ name, msg, level }) {\n    const prefix = this.verbose ? `[${name}][${nameFromLevel[level]}] ` : '';\n    return `${prefix}${msg}\\n`;\n  }\n\n  makeVerbose() {\n    this.verbose = true;\n  }\n\n  write(packet, { localProcess = process } = {}) {\n    const thisLevel = this.verbose ? bunyan.TRACE : bunyan.INFO;\n    if (packet.level >= thisLevel) {\n      const msg = this.format(packet);\n      if (this.isCapturing) {\n        this.capturedMessages.push(msg);\n      } else if (packet.level > bunyan.INFO) {\n        localProcess.stderr.write(msg);\n      } else {\n        localProcess.stdout.write(msg);\n      }\n    }\n  }\n\n  startCapturing() {\n    this.isCapturing = true;\n  }\n\n  stopCapturing() {\n    this.isCapturing = false;\n    this.capturedMessages = [];\n  }\n\n  flushCapturedLogs({ localProcess = process } = {}) {\n    for (const msg of this.capturedMessages) {\n      localProcess.stdout.write(msg);\n    }\n    this.capturedMessages = [];\n  }\n}\n\nexport const consoleStream = new ConsoleStream();\n\n// createLogger types and implementation.\n\nexport function createLogger(\n  moduleURL,\n  { createBunyanLog = defaultLogCreator } = {},\n) {\n  return createBunyanLog({\n    // Strip the leading src/ from file names (which is in all file names) to\n    // make the name less redundant.\n    name: moduleURL\n      ? fileURLToPath(moduleURL).replace(/^src\\//, '')\n      : 'unknown-module',\n    // Capture all log levels and let the stream filter them.\n    level: bunyan.TRACE,\n    streams: [\n      {\n        type: 'raw',\n        stream: consoleStream,\n      },\n    ],\n  });\n}\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,KAAK;AAEnC,OAAOC,MAAM,IACXC,aAAa,EACbC,YAAY,IAAIC,iBAAiB,QAC5B,QAAQ;AAEf,OAAO,MAAMC,aAAa,CAAC;EACzBC,OAAO;EACPC,WAAW;EACXC,gBAAgB;EAEhBC,WAAWA,CAAC;IAAEH,OAAO,GAAG;EAAM,CAAC,GAAG,CAAC,CAAC,EAAE;IACpC,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,gBAAgB,GAAG,EAAE;EAC5B;EAEAE,MAAMA,CAAC;IAAEC,IAAI;IAAEC,GAAG;IAAEC;EAAM,CAAC,EAAE;IAC3B,MAAMC,MAAM,GAAG,IAAI,CAACR,OAAO,GAAG,IAAIK,IAAI,KAAKT,aAAa,CAACW,KAAK,CAAC,IAAI,GAAG,EAAE;IACxE,OAAO,GAAGC,MAAM,GAAGF,GAAG,IAAI;EAC5B;EAEAG,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACT,OAAO,GAAG,IAAI;EACrB;EAEAU,KAAKA,CAACC,MAAM,EAAE;IAAEC,YAAY,GAAGC;EAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;IAC7C,MAAMC,SAAS,GAAG,IAAI,CAACd,OAAO,GAAGL,MAAM,CAACoB,KAAK,GAAGpB,MAAM,CAACqB,IAAI;IAC3D,IAAIL,MAAM,CAACJ,KAAK,IAAIO,SAAS,EAAE;MAC7B,MAAMR,GAAG,GAAG,IAAI,CAACF,MAAM,CAACO,MAAM,CAAC;MAC/B,IAAI,IAAI,CAACV,WAAW,EAAE;QACpB,IAAI,CAACC,gBAAgB,CAACe,IAAI,CAACX,GAAG,CAAC;MACjC,CAAC,MAAM,IAAIK,MAAM,CAACJ,KAAK,GAAGZ,MAAM,CAACqB,IAAI,EAAE;QACrCJ,YAAY,CAACM,MAAM,CAACR,KAAK,CAACJ,GAAG,CAAC;MAChC,CAAC,MAAM;QACLM,YAAY,CAACO,MAAM,CAACT,KAAK,CAACJ,GAAG,CAAC;MAChC;IACF;EACF;EAEAc,cAAcA,CAAA,EAAG;IACf,IAAI,CAACnB,WAAW,GAAG,IAAI;EACzB;EAEAoB,aAAaA,CAAA,EAAG;IACd,IAAI,CAACpB,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,gBAAgB,GAAG,EAAE;EAC5B;EAEAoB,iBAAiBA,CAAC;IAAEV,YAAY,GAAGC;EAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;IACjD,KAAK,MAAMP,GAAG,IAAI,IAAI,CAACJ,gBAAgB,EAAE;MACvCU,YAAY,CAACO,MAAM,CAACT,KAAK,CAACJ,GAAG,CAAC;IAChC;IACA,IAAI,CAACJ,gBAAgB,GAAG,EAAE;EAC5B;AACF;AAEA,OAAO,MAAMqB,aAAa,GAAG,IAAIxB,aAAa,CAAC,CAAC;;AAEhD;;AAEA,OAAO,SAASF,YAAYA,CAC1B2B,SAAS,EACT;EAAEC,eAAe,GAAG3B;AAAkB,CAAC,GAAG,CAAC,CAAC,EAC5C;EACA,OAAO2B,eAAe,CAAC;IACrB;IACA;IACApB,IAAI,EAAEmB,SAAS,GACX9B,aAAa,CAAC8B,SAAS,CAAC,CAACE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,GAC9C,gBAAgB;IACpB;IACAnB,KAAK,EAAEZ,MAAM,CAACoB,KAAK;IACnBY,OAAO,EAAE,CACP;MACEC,IAAI,EAAE,KAAK;MACXC,MAAM,EAAEN;IACV,CAAC;EAEL,CAAC,CAAC;AACJ","ignoreList":[]}