{"version":3,"file":"preferences.js","names":["WebExtError","UsageError","createLogger","log","import","meta","url","nonOverridablePreferences","prefsCommon","prefsFennec","prefsFirefox","prefs","common","fennec","firefox","getPrefs","app","appPrefs","coerceCLICustomPreference","cliPrefs","customPrefs","pref","prefsAry","split","length","key","value","slice","join","test","parseInt","includes","warn"],"sources":["../../src/firefox/preferences.js"],"sourcesContent":["/* @flow */\nimport {WebExtError, UsageError} from '../errors.js';\nimport {createLogger} from '../util/logger.js';\n\nconst log = createLogger(import.meta.url);\n\nexport const nonOverridablePreferences = [\n  'devtools.debugger.remote-enabled', 'devtools.debugger.prompt-connection',\n  'xpinstall.signatures.required',\n];\n\n// Flow Types\n\nexport type FirefoxPreferences = {\n  [key: string]: boolean | string | number,\n};\n\nexport type PreferencesAppName = 'firefox' | 'fennec';\n\n\n// Preferences Maps\n\nconst prefsCommon: FirefoxPreferences = {\n  // Allow debug output via dump to be printed to the system console\n  'browser.dom.window.dump.enabled': true,\n\n  // From:\n  // https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/internals/preferences.html#data-choices-notification\n  // This is the data submission master kill switch. If disabled, no policy is shown or upload takes place, ever.\n  'datareporting.policy.dataSubmissionEnabled': false,\n\n  // Allow remote connections to the debugger.\n  'devtools.debugger.remote-enabled': true,\n  // Disable the prompt for allowing connections.\n  'devtools.debugger.prompt-connection': false,\n  // Allow extensions to log messages on browser's console.\n  'devtools.browserconsole.contentMessages': true,\n\n  // Turn off platform logging because it is a lot of info.\n  'extensions.logging.enabled': false,\n\n  // Disable extension updates and notifications.\n  'extensions.checkCompatibility.nightly': false,\n  'extensions.update.enabled': false,\n  'extensions.update.notifyUser': false,\n\n  // From:\n  // http://hg.mozilla.org/mozilla-central/file/1dd81c324ac7/build/automation.py.in//l372\n  // Only load extensions from the application and user profile.\n  // AddonManager.SCOPE_PROFILE + AddonManager.SCOPE_APPLICATION\n  'extensions.enabledScopes': 5,\n  // Disable metadata caching for installed add-ons by default.\n  'extensions.getAddons.cache.enabled': false,\n  // Disable intalling any distribution add-ons.\n  'extensions.installDistroAddons': false,\n  // Allow installing extensions dropped into the profile folder.\n  'extensions.autoDisableScopes': 10,\n\n  // Disable app update.\n  'app.update.enabled': false,\n\n  // Allow unsigned add-ons.\n  'xpinstall.signatures.required': false,\n\n  // browser.link.open_newwindow is changed from 3 to 2 in:\n  // https://github.com/saadtazi/firefox-profile-js/blob/cafc793d940a779d280103ae17d02a92de862efc/lib/firefox_profile.js#L32\n  // Restore original value to avoid https://github.com/mozilla/web-ext/issues/1592\n  'browser.link.open_newwindow': 3,\n};\n\n// Prefs specific to Firefox for Android.\nconst prefsFennec: FirefoxPreferences = {\n  'browser.console.showInPanel': true,\n  'browser.firstrun.show.uidiscovery': false,\n  'devtools.remote.usb.enabled': true,\n};\n\n// Prefs specific to Firefox for desktop.\nconst prefsFirefox: FirefoxPreferences = {\n  'browser.startup.homepage': 'about:blank',\n  'startup.homepage_welcome_url': 'about:blank',\n  'startup.homepage_welcome_url.additional': '',\n  'devtools.errorconsole.enabled': true,\n  'devtools.chrome.enabled': true,\n\n  // From:\n  // http://hg.mozilla.org/mozilla-central/file/1dd81c324ac7/build/automation.py.in//l388\n  // Make url-classifier updates so rare that they won't affect tests.\n  'urlclassifier.updateinterval': 172800,\n  // Point the url-classifier to a nonexistent local URL for fast failures.\n  'browser.safebrowsing.provider.0.gethashURL':\n    'http://localhost/safebrowsing-dummy/gethash',\n  'browser.safebrowsing.provider.0.keyURL':\n    'http://localhost/safebrowsing-dummy/newkey',\n  'browser.safebrowsing.provider.0.updateURL':\n    'http://localhost/safebrowsing-dummy/update',\n\n  // Disable self repair/SHIELD\n  'browser.selfsupport.url': 'https://localhost/selfrepair',\n  // Disable Reader Mode UI tour\n  'browser.reader.detectedFirstArticle': true,\n\n  // Set the policy firstURL to an empty string to prevent\n  // the privacy info page to be opened on every \"web-ext run\".\n  // (See #1114 for rationale)\n  'datareporting.policy.firstRunURL': '',\n};\n\nconst prefs = {\n  common: prefsCommon,\n  fennec: prefsFennec,\n  firefox: prefsFirefox,\n};\n\n\n// Module exports\n\nexport type PreferencesGetterFn =\n  (appName: PreferencesAppName) => FirefoxPreferences;\n\nexport function getPrefs(\n  app: PreferencesAppName = 'firefox'\n): FirefoxPreferences {\n  const appPrefs = prefs[app];\n  if (!appPrefs) {\n    throw new WebExtError(`Unsupported application: ${app}`);\n  }\n  return {\n    ...prefsCommon,\n    ...appPrefs,\n  };\n}\n\nexport function coerceCLICustomPreference(\n  cliPrefs: Array<string>\n): FirefoxPreferences {\n  const customPrefs = {};\n\n  for (const pref of cliPrefs) {\n    const prefsAry = pref.split('=');\n\n    if (prefsAry.length < 2) {\n      throw new UsageError(\n        `Incomplete custom preference: \"${pref}\". ` +\n        'Syntax expected: \"prefname=prefvalue\".'\n      );\n    }\n\n    const key = prefsAry[0];\n    let value = prefsAry.slice(1).join('=');\n\n    if (/[^\\w{@}.-]/.test(key)) {\n      throw new UsageError(`Invalid custom preference name: ${key}`);\n    }\n\n    if (value === `${parseInt(value)}`) {\n      value = parseInt(value, 10);\n    } else if (value === 'true' || value === 'false') {\n      value = (value === 'true');\n    }\n\n    if (nonOverridablePreferences.includes(key)) {\n      log.warn(`'${key}' preference cannot be customized.`);\n      continue;\n    }\n    customPrefs[`${key}`] = value;\n  }\n\n  return customPrefs;\n}\n"],"mappings":"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"}