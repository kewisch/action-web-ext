let github;_60f‍.x([["default",()=>CheckRun]]);_60f‍.w("@actions/github",[["*",null,function(v){github=v}]]);/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 * Portions Copyright (C) Philipp Kewisch, 2019 */



               class CheckRun {
  constructor(name, context, token) {
    this.name = name;
    this.context = context;

    this.id = null;
    this.octokit = github.getOctokit(token);
    this.ready = (token != null);
  }

  async create() {
    if (!this.ready) {
      return;
    }

    let res = await this.octokit.checks.create({
      ...this.context.repo,
      head_sha: this.context.sha,
      name: "Test: " + this.name,
      status: "in_progress",
      started_at: new Date().toISOString()
    });

    this.id = res.data.id;
  }

  async complete(summary, nonfatal, fatal) {
    if (!this.ready) {
      return;
    }

    await this.octokit.checks.update({
      ...this.context.repo,
      head_sha: this.context.sha,
      check_run_id: this.id,
      status: "completed",
      completed_at: new Date().toISOString(),
      conclusion: fatal.length ? "failure" : "success",
      output: {
        title: this.name,
        summary: summary,
        annotations: nonfatal.concat(fatal)
      }
    });
  }
}
